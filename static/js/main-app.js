var fe=Object.defineProperty;var re=(t,e,n)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var G=(t,e,n)=>re(t,typeof e!="symbol"?e+"":e,n);function N(){}function oe(t){return t()}function X(){return Object.create(null)}function J(t){t.forEach(oe)}function ce(t){return typeof t=="function"}function ue(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function de(t){return Object.keys(t).length===0}function p(t,e){t.appendChild(e)}function y(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function _e(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function w(t){return document.createElement(t)}function A(t){return document.createTextNode(t)}function E(){return A(" ")}function Y(t,e,n,l){return t.addEventListener(e,n,l),()=>t.removeEventListener(e,n,l)}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function he(t){return Array.from(t.childNodes)}function M(t,e){e=""+e,t.data!==e&&(t.data=e)}function C(t,e,n){t.classList.toggle(e,!!n)}let V;function U(t){V=t}function pe(){if(!V)throw new Error("Function called outside component initialization");return V}function ge(t){pe().$$.on_mount.push(t)}const z=[],Z=[];let F=[];const x=[],me=Promise.resolve();let K=!1;function ve(){K||(K=!0,me.then(se))}function Q(t){F.push(t)}const H=new Set;let P=0;function se(){if(P!==0)return;const t=V;do{try{for(;P<z.length;){const e=z[P];P++,U(e),we(e.$$)}}catch(e){throw z.length=0,P=0,e}for(U(null),z.length=0,P=0;Z.length;)Z.pop()();for(let e=0;e<F.length;e+=1){const n=F[e];H.has(n)||(H.add(n),n())}F.length=0}while(z.length);for(;x.length;)x.pop()();K=!1,H.clear(),U(t)}function we(t){if(t.fragment!==null){t.update(),J(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Q)}}function ke(t){const e=[],n=[];F.forEach(l=>t.indexOf(l)===-1?e.push(l):n.push(l)),n.forEach(l=>l()),F=e}const be=new Set;function ae(t,e){t&&t.i&&(be.delete(t),t.i(e))}function q(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function $e(t,e){t.d(1),e.delete(t.key)}function ye(t,e,n,l,f,d,r,i,o,c,u,s){let a=t.length,_=d.length,h=a;const j={};for(;h--;)j[t[h].key]=h;const S=[],W=new Map,O=new Map,R=[];for(h=_;h--;){const g=s(f,d,h),k=n(g);let m=r.get(k);m?R.push(()=>m.p(g,e)):(m=c(k,g),m.c()),W.set(k,S[h]=m),k in j&&O.set(k,Math.abs(h-j[k]))}const T=new Set,B=new Set;function D(g){ae(g,1),g.m(i,u),r.set(g.key,g),u=g.first,_--}for(;a&&_;){const g=S[_-1],k=t[a-1],m=g.key,I=k.key;g===k?(u=g.first,a--,_--):W.has(I)?!r.has(m)||T.has(m)?D(g):B.has(I)?a--:O.get(m)>O.get(I)?(B.add(m),D(g)):(T.add(I),a--):(o(k,r),a--)}for(;a--;){const g=t[a];W.has(g.key)||o(g,r)}for(;_;)D(S[_-1]);return J(R),S}function Se(t,e,n){const{fragment:l,after_update:f}=t.$$;l&&l.m(e,n),Q(()=>{const d=t.$$.on_mount.map(oe).filter(ce);t.$$.on_destroy?t.$$.on_destroy.push(...d):J(d),t.$$.on_mount=[]}),f.forEach(Q)}function Ee(t,e){const n=t.$$;n.fragment!==null&&(ke(n.after_update),J(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function We(t,e){t.$$.dirty[0]===-1&&(z.push(t),ve(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,n,l,f,d,r=null,i=[-1]){const o=V;U(t);const c=t.$$={fragment:null,ctx:[],props:d,update:N,not_equal:f,bound:X(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:X(),dirty:i,skip_bound:!1,root:e.target||o.$$.root};r&&r(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(s,a,..._)=>{const h=_.length?_[0]:a;return c.ctx&&f(c.ctx[s],c.ctx[s]=h)&&(!c.skip_bound&&c.bound[s]&&c.bound[s](h),u&&We(t,s)),a}):[],c.update(),u=!0,J(c.before_update),c.fragment=l?l(c.ctx):!1,e.target){if(e.hydrate){const s=he(e.target);c.fragment&&c.fragment.l(s),s.forEach($)}else c.fragment&&c.fragment.c();e.intro&&ae(t.$$.fragment),Se(t,e.target,e.anchor),se()}U(o)}class Ae{constructor(){G(this,"$$");G(this,"$$set")}$destroy(){Ee(this,1),this.$destroy=N}$on(e,n){if(!ce(n))return N;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(n),()=>{const f=l.indexOf(n);f!==-1&&l.splice(f,1)}}$set(e){this.$$set&&!de(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ne="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ne);function ee(t,e,n){const l=t.slice();return l[8]=e[n],l}function te(t,e,n){const l=t.slice();return l[11]=e[n],l}function ne(t){let e;return{c(){e=w("span"),e.textContent="Пока нет активных событий",v(e,"class","empty")},m(n,l){y(n,e,l)},p:N,d(n){n&&$(e)}}}function Oe(t){let e,n,l=new Date(t[8].time).toLocaleString()+"",f;function d(o,c){return o[8].data.login===void 0?je:Me}let r=d(t),i=r(t);return{c(){i.c(),e=E(),n=w("div"),f=A(l),v(n,"class","ceated")},m(o,c){i.m(o,c),y(o,e,c),y(o,n,c),p(n,f)},p(o,c){r===(r=d(o))&&i?i.p(o,c):(i.d(1),i=r(o),i&&(i.c(),i.m(e.parentNode,e))),c&1&&l!==(l=new Date(o[8].time).toLocaleString()+"")&&M(f,l)},d(o){o&&($(e),$(n)),i.d(o)}}}function Le(t){let e;return{c(){e=w("div"),e.textContent="Загрузка данных ...",v(e,"class","loading-data")},m(n,l){y(n,e,l)},p:N,d(n){n&&$(e)}}}function Me(t){let e,n=t[8].data.full_name+"",l,f,d,r=q(t[8].data.addresses),i=[];for(let o=0;o<r.length;o+=1)i[o]=le(te(t,r,o));return{c(){e=w("div"),l=A(n),f=E(),d=w("div");for(let o=0;o<i.length;o+=1)i[o].c();v(e,"class","data"),v(d,"class","adresses")},m(o,c){y(o,e,c),p(e,l),y(o,f,c),y(o,d,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(d,null)},p(o,c){if(c&1&&n!==(n=o[8].data.full_name+"")&&M(l,n),c&1){r=q(o[8].data.addresses);let u;for(u=0;u<r.length;u+=1){const s=te(o,r,u);i[u]?i[u].p(s,c):(i[u]=le(s),i[u].c(),i[u].m(d,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=r.length}},d(o){o&&($(e),$(f),$(d)),_e(i,o)}}}function je(t){let e;return{c(){e=w("div"),e.textContent="Неизвестный абонент",v(e,"class","empty-data")},m(n,l){y(n,e,l)},p:N,d(n){n&&$(e)}}}function le(t){let e,n=t[11]+"",l;return{c(){e=w("span"),l=A(n),v(e,"class","address")},m(f,d){y(f,e,d),p(e,l)},p(f,d){d&1&&n!==(n=f[11]+"")&&M(l,n)},d(f){f&&$(e)}}}function ie(t,e){let n,l,f=e[8].action+"",d,r,i,o,c=e[8].phone+"",u,s,a,_=e[8].event_id+"",h,j,S,W=e[8].status+"",O,R,T,B,D;function g(L,b){return L[8].data===null?Le:Oe}let k=g(e),m=k(e);function I(){return e[1](e[8])}return{key:t,first:null,c(){n=w("div"),l=w("div"),d=A(f),r=E(),i=w("div"),o=w("div"),u=A(c),s=E(),a=w("div"),h=A(_),j=E(),S=w("div"),O=A(W),R=E(),m.c(),T=E(),v(l,"class","action-type"),v(o,"class","phone"),v(a,"class","event-id"),v(S,"class","status"),v(i,"class","action-body"),v(n,"role","button"),v(n,"tabindex","0"),v(n,"class","action-item"),C(n,"clickable",e[8].data!==null&&e[8].data.login!==void 0),C(n,"welcome",e[8].action==="welcome"),C(n,"calling",e[8].action==="calling"),C(n,"answered",e[8].action==="answered"),this.first=n},m(L,b){y(L,n,b),p(n,l),p(l,d),p(n,r),p(n,i),p(i,o),p(o,u),p(i,s),p(i,a),p(a,h),p(i,j),p(i,S),p(S,O),p(i,R),m.m(i,null),p(n,T),B||(D=[Y(n,"keypress",ze),Y(n,"click",I)],B=!0)},p(L,b){e=L,b&1&&f!==(f=e[8].action+"")&&M(d,f),b&1&&c!==(c=e[8].phone+"")&&M(u,c),b&1&&_!==(_=e[8].event_id+"")&&M(h,_),b&1&&W!==(W=e[8].status+"")&&M(O,W),k===(k=g(e))&&m?m.p(e,b):(m.d(1),m=k(e),m&&(m.c(),m.m(i,null))),b&1&&C(n,"clickable",e[8].data!==null&&e[8].data.login!==void 0),b&1&&C(n,"welcome",e[8].action==="welcome"),b&1&&C(n,"calling",e[8].action==="calling"),b&1&&C(n,"answered",e[8].action==="answered")},d(L){L&&$(n),m.d(),B=!1,J(D)}}}function Be(t){let e,n,l,f,d,r,i=[],o=new Map,c=q(t[0]);const u=a=>a[8].event_id;for(let a=0;a<c.length;a+=1){let _=ee(t,c,a),h=u(_);o.set(h,i[a]=ie(h,_))}let s=null;return c.length||(s=ne()),{c(){e=w("div"),n=w("h1"),n.textContent="Активные события",l=E(),f=w("hr"),d=E(),r=w("div");for(let a=0;a<i.length;a+=1)i[a].c();s&&s.c(),v(r,"class","action-field"),v(e,"class","app-container svelte-v219wt")},m(a,_){y(a,e,_),p(e,n),p(e,l),p(e,f),p(e,d),p(e,r);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(r,null);s&&s.m(r,null)},p(a,[_]){_&1&&(c=q(a[0]),i=ye(i,_,u,1,a,c,o,r,$e,ie,null,ee),!c.length&&s?s.p(a,_):c.length?s&&(s.d(1),s=null):(s=ne(),s.c(),s.m(r,null)))},i:N,o:N,d(a){a&&$(e);for(let _=0;_<i.length;_+=1)i[_].d();s&&s.d()}}}function De(t){Alert.info("WS-сервер подключился.","Соединение установлено.",10)}function Ie(t){console.log("WS error: ",t)}function Pe(t){!t.data||t.data.profile_url===void 0||window.open(t.data.profile_url,"_blank")}const ze=()=>{};function Fe(t,e,n){let l=null;const f="ws:"+window.location.host+"/ws";let d=[];function r({data:s}){const a=JSON.parse(s);console.log("WS message: ",a),n(0,d=a)}function i(s){Alert.warning("WS-сервер закрыл соединение.<br>Пытаюсь переподключиться ...","Соединение закрыто."),c()}function o(){(!l||l.readyState==WebSocket.CLOSED)&&(l=new WebSocket(f),l.onopen=De,l.onmessage=r,l.onclose=i,l.onerror=Ie)}function c(){l=null;try{o()}catch(s){console.log(s)}}return ge(()=>{c()}),[d,s=>Pe(s)]}class Je extends Ae{constructor(e){super(),Ce(this,e,Fe,Be,ue,{})}}new Je({target:document.getElementById("app")});
