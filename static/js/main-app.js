var oe=Object.defineProperty;var ie=(e,t,n)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var L=(e,t,n)=>ie(e,typeof t!="symbol"?t+"":t,n);function E(){}function Z(e){return e()}function q(){return Object.create(null)}function N(e){e.forEach(Z)}function ee(e){return typeof e=="function"}function le(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function ce(e){return Object.keys(e).length===0}function g(e,t){e.appendChild(t)}function R(e,t,n){e.insertBefore(t,n||null)}function I(e){e.parentNode&&e.parentNode.removeChild(e)}function $(e){return document.createElement(e)}function W(e){return document.createTextNode(e)}function O(){return W(" ")}function b(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function se(e){return Array.from(e.childNodes)}function P(e,t){t=""+t,e.data!==t&&(e.data=t)}let j;function M(e){j=e}function fe(){if(!j)throw new Error("Function called outside component initialization");return j}function re(e){fe().$$.on_mount.push(e)}const S=[],G=[];let C=[];const H=[],ue=Promise.resolve();let D=!1;function ae(){D||(D=!0,ue.then(te))}function F(e){C.push(e)}const z=new Set;let x=0;function te(){if(x!==0)return;const e=j;do{try{for(;x<S.length;){const t=S[x];x++,M(t),de(t.$$)}}catch(t){throw S.length=0,x=0,t}for(M(null),S.length=0,x=0;G.length;)G.pop()();for(let t=0;t<C.length;t+=1){const n=C[t];z.has(n)||(z.add(n),n())}C.length=0}while(S.length);for(;H.length;)H.pop()();D=!1,z.clear(),M(e)}function de(e){if(e.fragment!==null){e.update(),N(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}function he(e){const t=[],n=[];C.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),C=t}const pe=new Set;function ne(e,t){e&&e.i&&(pe.delete(e),e.i(t))}function K(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function _e(e,t){e.d(1),t.delete(e.key)}function ge(e,t,n,i,h,f,d,u,_,c,r,l){let o=e.length,s=f.length,a=o;const k={};for(;a--;)k[e[a].key]=a;const m=[],v=new Map,B=new Map,T=[];for(a=s;a--;){const p=l(h,f,a),w=n(p);let y=d.get(w);y?T.push(()=>y.p(p,t)):(y=c(w,p),y.c()),v.set(w,m[a]=y),w in k&&B.set(w,Math.abs(a-k[w]))}const U=new Set,V=new Set;function J(p){ne(p,1),p.m(u,r),d.set(p.key,p),r=p.first,s--}for(;o&&s;){const p=m[s-1],w=e[o-1],y=p.key,A=w.key;p===w?(r=p.first,o--,s--):v.has(A)?!d.has(y)||U.has(y)?J(p):V.has(A)?o--:B.get(y)>B.get(A)?(V.add(y),J(p)):(U.add(A),o--):(_(w,d),o--)}for(;o--;){const p=e[o];v.has(p.key)||_(p,d)}for(;s;)J(m[s-1]);return N(T),m}function me(e,t,n){const{fragment:i,after_update:h}=e.$$;i&&i.m(t,n),F(()=>{const f=e.$$.on_mount.map(Z).filter(ee);e.$$.on_destroy?e.$$.on_destroy.push(...f):N(f),e.$$.on_mount=[]}),h.forEach(F)}function we(e,t){const n=e.$$;n.fragment!==null&&(he(n.after_update),N(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ye(e,t){e.$$.dirty[0]===-1&&(S.push(e),ae(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function $e(e,t,n,i,h,f,d=null,u=[-1]){const _=j;M(e);const c=e.$$={fragment:null,ctx:[],props:f,update:E,not_equal:h,bound:q(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:q(),dirty:u,skip_bound:!1,root:t.target||_.$$.root};d&&d(c.root);let r=!1;if(c.ctx=n?n(e,t.props||{},(l,o,...s)=>{const a=s.length?s[0]:o;return c.ctx&&h(c.ctx[l],c.ctx[l]=a)&&(!c.skip_bound&&c.bound[l]&&c.bound[l](a),r&&ye(e,l)),o}):[],c.update(),r=!0,N(c.before_update),c.fragment=i?i(c.ctx):!1,t.target){if(t.hydrate){const l=se(t.target);c.fragment&&c.fragment.l(l),l.forEach(I)}else c.fragment&&c.fragment.c();t.intro&&ne(e.$$.fragment),me(e,t.target,t.anchor),te()}M(_)}class ve{constructor(){L(this,"$$");L(this,"$$set")}$destroy(){we(this,1),this.$destroy=E}$on(t,n){if(!ee(n))return E;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const h=i.indexOf(n);h!==-1&&i.splice(h,1)}}$set(t){this.$$set&&!ce(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const be="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(be);function Q(e,t,n){const i=e.slice();return i[7]=t[n],i}function X(e){let t;return{c(){t=$("span"),t.textContent="Пока нет активных событий",b(t,"class","empty")},m(n,i){R(n,t,i)},p:E,d(n){n&&I(t)}}}function Y(e,t){let n,i,h=t[7].action+"",f,d,u,_,c=t[7].phone+"",r,l,o,s=t[7].status+"",a,k;return{key:e,first:null,c(){n=$("div"),i=$("div"),f=W(h),d=O(),u=$("div"),_=$("div"),r=W(c),l=O(),o=$("div"),a=W(s),k=O(),b(i,"class","action-type"),b(_,"class","phone"),b(o,"class","status"),b(u,"class","action-body"),b(n,"class","action-item"),this.first=n},m(m,v){R(m,n,v),g(n,i),g(i,f),g(n,d),g(n,u),g(u,_),g(_,r),g(u,l),g(u,o),g(o,a),g(n,k)},p(m,v){t=m,v&1&&h!==(h=t[7].action+"")&&P(f,h),v&1&&c!==(c=t[7].phone+"")&&P(r,c),v&1&&s!==(s=t[7].status+"")&&P(a,s)},d(m){m&&I(n)}}}function ke(e){let t,n,i,h,f,d,u=[],_=new Map,c=K(e[0]);const r=o=>o[7].id;for(let o=0;o<c.length;o+=1){let s=Q(e,c,o),a=r(s);_.set(a,u[o]=Y(a,s))}let l=null;return c.length||(l=X()),{c(){t=$("div"),n=$("h1"),n.textContent="Активные события",i=O(),h=$("hr"),f=O(),d=$("div");for(let o=0;o<u.length;o+=1)u[o].c();l&&l.c(),b(d,"class","action-field"),b(t,"class","app-container svelte-1eyiatd")},m(o,s){R(o,t,s),g(t,n),g(t,i),g(t,h),g(t,f),g(t,d);for(let a=0;a<u.length;a+=1)u[a]&&u[a].m(d,null);l&&l.m(d,null)},p(o,[s]){s&1&&(c=K(o[0]),u=ge(u,s,r,1,o,c,_,d,_e,Y,null,Q),!c.length&&l?l.p(o,s):c.length?l&&(l.d(1),l=null):(l=X(),l.c(),l.m(d,null)))},i:E,o:E,d(o){o&&I(t);for(let s=0;s<u.length;s+=1)u[s].d();l&&l.d()}}}function xe(e){console.log("Chat close: ",e)}function Se(e){console.log("Chat error: ",e)}function Ce(e,t,n){let i=null;const h="ws:"+window.location.host+"/ws";let f=[{id:1,phone:"89217809021",action:"new",status:"user",data:{}}];function d(r){if(r.action==="new"){n(0,f=[r,...f]);return}if(r.action==="done"){n(0,f=f.filter(l=>l.phone!==r.phone));return}if(r.action==="update"){const l=f.findIndex(o=>o.phone===r.phone);Object.assign(f[l],{data:r.data})}else{const l=f.findIndex(o=>o.phone===r.phone);Object.assign(f[l],{action:r.action})}n(0,f=[...f])}function u(r){i.send(JSON.stringify({type:"join",data:{msg:""}}))}function _({data:r}){const l=JSON.parse(r);d(l),console.log("Chat message: ",l)}function c(){(!i||i.readyState==WebSocket.CLOSED)&&(i=new WebSocket(h),i.onopen=u,i.onmessage=_,i.onclose=xe,i.onerror=Se)}return re(()=>{c()}),[f]}class Ee extends ve{constructor(t){super(),$e(this,t,Ce,ke,le,{})}}new Ee({target:document.getElementById("app")});
